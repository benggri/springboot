<!DOCTYPE html>
<html lang="en">
<head th:replace='/html/layout/head'></head>
<body>
    <header th:replace='/html/components/header'></header>

    <div class="mt-3 container-fluid">
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs" id="board_tabs"></ul>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="board" role="tabpanel" aria-labelledby="board-content">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">게시글번호</th>
                                    <th scope="col">제목</th>
                                    <th scope="col">작성자</th>
                                    <th scope="col">작성일시</th>
                                    <th scope="col">조회수</th>
                                    <th scope="col">좋아요</th>
                                    <th scope="col">싫어요</th>
                                </tr>
                            </thead>
                            <tbody id="post_table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="card-footer">

            </div>
        </div>
    </div>

    <script type="text/javascript">
        class Board {
            constructor() {
                this.boardIdx = 1;
            }

            setBoardIdx(boardIdx) {
                this.boardIdx = boardIdx;
                this.getPosts(1);
            }

            getPosts(pageNo=1) {
                axios.get(`/board/${this.boardIdx}/posts?pageNo=${pageNo}`)
                     .then((res) => {
                         console.log(res);
                         $('#post_table').children().remove();
                         res.data.data.forEach((post, idx) => {
                             let tr = $('<tr></tr>').appendTo($('#post_table'));
                             $(tr).append(`<th scope="row">${post.postIdx}</th>
                                           <td>${post.title}</td>
                                           <td>${post.nickname}</td>
                                           <td>${util.dateFormat(post.writeDate)}</td>
                                           <td>${post.viewCnt}</td>
                                           <td>${post.likeCnt}</td>
                                           <td>${post.unlikeCnt}</td>`);
                         });
                     });
            }
        }
        const board = new Board();

        $(() => {
          axios.get('/boards', {})
               .then((res) => {
                   // console.log(res);
                   $('#board_tabs').children().remove();
                   res.data.data.forEach((board, idx) => {
                       var active = ((idx === 0) ? 'active' : '');
                       $('#board_tabs').append(`<li class="nav-item">
                                                    <button class="nav-link ${active}" id="board_tab" data-bs-toggle="tab" data-bs-target="#board" onclick="board.setBoardIdx(${board.boardIdx})">${board.boardName}</button>
                                                </li>`);
                   });
                   board.getPosts(1);
               });
        });

    </script>
</body>
</html>